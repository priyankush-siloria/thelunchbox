
$(document).ready(function() {
    function t(t) {
        var e = null;
        if (document.cookie && "" != document.cookie)
            for (var a = document.cookie.split(";"), s = 0; s < a.length; s++) {
                var r = jQuery.trim(a[s]);
                if (r.substring(0, t.length + 1) == t + "=") {
                    e = decodeURIComponent(r.substring(t.length + 1));
                    break
                }
            }
        return e
    }

    function e(t) {
        return /^(GET|HEAD|OPTIONS|TRACE)$/.test(t)
    }

    function a(t) {
        var e = document.location.host,
            a = document.location.protocol,
            s = "//" + e,
            r = a + s;
        return t == r || t.slice(0, r.length + 1) == r + "/" || t == s || t.slice(0, s.length + 1) == s + "/" || !/^(\/\/|http:|https:).*/.test(t)
    }

    function s(t, e) {
        if (t.files && t.files[0]) {
            var a = new FileReader;
            a.onload = function(t) {
                $(e).attr({
                    src: t.target.result
                })
            }, a.readAsDataURL(t.files[0])
        }
    }
    var r = t("csrftoken");
    $(".upload_image").on("click", function(t) {
        t.preventDefault();
        var e = $(this).attr("data-class");
        $(".upload_btn-" + e).children(".image_upload_btn").click()
    }), $(document).on("change", ".image_upload_btn", function(t) {
        if (!($(this).parent().parent().find(".preview").length > 0)) {
            var e = "<img src='' class='preview'/>";
            $(this).parent().parent().find(".upload_image").append(e)
        }
        var a = $(this).parent().parent().find(".preview");
        s(this, a, t), a.css("display", "block")
    }), ($(".timepicker").length || $(".datepicker").length) && ($(".timepicker").datetimepicker({
        datepicker: !1,
        format: "H:i",
        theme: "dark"
    }), $(".datepicker").datetimepicker({
        timepicker: !1,
        format: "M d Y",
        theme: "dark"
    })), $(".nutrition-facts li a").click(function(t) {
        t.preventDefault();
        var e = $(this).attr("data-class"),
            a = $(".nutrition-choices ." + e).clone(),
            s = e.split("_").length > 1 ? e.split("_")[0] + " " + e.split("_")[1] : e.split("_")[0],
            r = $(".lunchbox_nutrition-facts"),
            i = "<li class='" + e + "'><p>" + s + "</p></li>";
        $(r).children("." + e)[0] ? $(r).children("." + e).append(a) : ($(r).append(i), $(r).children("." + e).append(a))
    }), $(".lb-desc").focus(function() {
        $(this).text("")
    }), $(document).on("click", ".remove-nutrition", function(t) {
        t.preventDefault(), $(this).parent().parent().parent().find(".trans_select_box_wrapper").length > 1 ? $(this).parent().remove() : $(this).parent().parent().remove()
    }), $(document).on("click", ".lunchbox_submit_btn", function(t) {
        t.preventDefault();
        var e = {};
        $(".lunchbox_nutrition-facts").children("li").each(function() {
            var t = $(this).attr("class");
            t in e || (e[t] = []), $(this).children(".trans_select_box_wrapper").each(function() {
                e[$(this).attr("data-class")].push({
                    id: $(this).find("select").val(),
                    val: $(this).find('input[name="value"]').val()
                })
            })
        }), $(".nf_input").val(JSON.stringify(e)), $(".lunchbox_form").submit()
    }), $(".lunchboxTabs a").click(function(t) {
        t.preventDefault(), $(this).tab("show");
        var s = parseInt($(this).attr("data-id")),
            i = $(".communication_box_content");
        i.length && $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/get_lunchbox_admin_messages/",
            type: "POST",
            data: {
                lunchbox: s
            },
            success: function(t) {
                i.html(""), t.data.photoshoot_requested && i.append("<p>" + gettext("Photoshoot requested") + ": " + t.data.photoshoot_requested + "</p><br>"), t.data.msg && i.append("<p>" + t.data.msg + "</p><br>")
            }
        })
    }), $(".lunchboxTabs a:first").click(), $(".restaurant_submit_btn").click(function(t) {
        t.preventDefault();
        var e = {};
        $(".city_delivery").each(function() {
            e[parseInt($(this).attr("id"))] = $(this).is(":checked")
        }), $(".delivery_to").val(JSON.stringify(e)), $(".restaurant_edit_form").submit()
    }), $(".order-status-check").click(function() {
        var t = $(this).attr("data-id"),
            s = $(this).attr("data-status"),
            i = $(this).parent().parent().parent();
        $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/control/set_order_process_status/",
            type: "POST",
            data: {
                order_item_id: t,
                status: s
            },
            success: function(t) {
                var e = "";
                i.hasClass("status_info") ? (i.removeClass("status_info").addClass("status_default_steps"), "2" === s ? e = "<strong>" + gettext("Request payment") + ":</strong> " + gettext("not available yet") : "3" === s ? e = "<strong>" + gettext("To be confirmed by La Fiambrera") + "</strong>" : "4" === s && (e = "<strong>" + gettext("Payment") + "</strong>")) : "1" !== s && ("2" === s ? e = "<strong>" + gettext("Payment requested") + ": </strong>" + t.data.date : "3" === s ? e = "<strong>" + gettext("Confirmed") + ": </strong> " + t.data.date : "4" === s && (e = "<strong>" + gettext("Transferred") + ": </strong>" + t.data.date), i.removeClass("status_default_steps").addClass("status_info")), i.children(".col-md-14").html(e)
            }
        })
    }), $(".priority-check").click(function(t) {
        var s = $(this).parents(".notification_priority").attr("data-id"),
            i = $(this).parents(".notification_priority").attr("data-idd"),
            n = $(this).attr("data-priority"),
            o = $(this).parents(".notification_msg"),
            c = $(this).parent().parent(),
            l = 0;
        $(this).parents(".notification_msg").hasClass("lb-admin-msg") && (l = 1), $(this).parents(".notification_msg").hasClass("lb-order-msg") && (l = 2), o.removeClass("status_default"), 1 == n ? o.hasClass("high-priority") ? (o.removeClass("high-priority").addClass("status_default"), n = 4) : (c.children(".less-priority").children(".priority-check").prop("checked", !1), c.children(".low-priority").children(".priority-check").prop("checked", !1)) : 2 == n ? o.hasClass("less-priority") ? (o.removeClass("less-priority").addClass("status_default"), n = 4) : (c.children(".high-priority").children(".priority-check").prop("checked", !1), c.children(".low-priority").children(".priority-check").prop("checked", !1)) : 3 == n && (o.hasClass("low-priority") ? (o.removeClass("low-priority").addClass("status_default"), n = 4) : (c.children(".high-priority").children(".priority-check").prop("checked", !1), c.children(".less-priority").children(".priority-check").prop("checked", !1))), $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/control/set_msg_priority/",
            type: "POST",
            data: {
                msg_id: s,
                idd: i,
                priority: n,
                lb_msg_type: l
            },
            success: function(t) {
                "success" == t.data.msg && (1 == n ? o.removeClass("low-priority").removeClass("less-priority").addClass("high-priority") : 2 == n ? o.removeClass("high-priority").removeClass("low-priority").addClass("less-priority") : 3 == n && o.removeClass("high-priority").removeClass("less-priority").addClass("low-priority"))
            }
        })
    }), $(".btn-reply").click(function() {
        $(this).hasClass("clicked") ? $(this).removeClass("clicked") : $(this).addClass("clicked"), $(this).parents(".notification_msg").children(".notification_reply").fadeToggle()
    }), $(".notification_reply button").click(function() {
        var t = $(this).parent().children(".msgs"),
            s = $(this).parent().children(".msg"),
            i = $(this),
            n = 0,
            o = $(this).parents(".notification_msg").attr("data-lb"),
            c = $(this).parents(".notification_msg").attr("data-mid"),
            l = $(this).parents(".notification_msg").attr("data-u"),
            d = $(this).parents(".notification_msg");
        $(this).parent().hasClass("a_reply") && (n = 1), $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/restaurant_reply/",
            type: "POST",
            data: {
                uid: l,
                mid: c,
                lb: o,
                admin_reply: n,
                msg: $(s).val()
            },
            success: function(e) {
                var a = "<strong>" + e.user + "</strong><div class='clearfix'></div><span>" + e.date + "</span><p>" + s.val() + "</p>\n";
                $(t).append(a), $(t).animate({
                    scrollTop: $(t)[0].scrollHeight
                }), $(s).val(""), $(s).remove(), $(i).remove(), setTimeout(function() {
                    $(d).remove()
                }, 2e3)
            }
        })
    }), $(".communication_box_with_restaurant button").click(function() {
        var t = $(this).parent().children(".restaurant-lunchbox-msgs"),
            s = $(this).parent().children(".msg"),
            i = 1,
            n = $(this).parent().attr("data-lb");
        $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/restaurant_reply/",
            type: "POST",
            data: {
                lb: n,
                admin_reply: i,
                msg: $(s).val()
            },
            success: function(e) {
                var a = "<strong>" + e.user + "</strong><div class='clearfix'></div><span>" + e.date + "</span><p>" + s.val() + "</p>\n";
                $(t).prepend(a), $(s).val("")
            }
        })
    }), $(".archive_notification").click(function() {
        var t = $(this).parents(".notification_msg").attr("data-mid"),
            s = $(this).parents(".notification_msg").attr("data-u"),
            i = $(this).parents(".notification_msg"),
            n = 0;
        $(this).hasClass("lb-admin-msg") && (n = 1), $(this).hasClass("lb-order-msg") && (n = 2), $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/archive_notification/",
            type: "POST",
            data: {
                uid: s,
                mid: t,
                lb_msg_type: n
            },
            success: function(t) {
                console.log(t), "Success!" == t.msg && setTimeout(function() {
                    $(i).remove()
                }, 500)
            }
        })
    }), $(".lb-chat").each(function() {
        $(this).children(".msgs").animate({
            scrollTop: $(this).children(".msgs")[0].scrollHeight
        }, 500)
    }), $(".lb-chat button").click(function() {
        var t = $(this).parent().children(".msgs"),
            s = $(this).parent().children(".msg"),
            i = $(this).parent().attr("data-lb"),
            n = $(this).parent().attr("data-res");
        $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/ask_restaurant/",
            type: "POST",
            data: {
                lb: i,
                res: n,
                msg: $(s).val()
            },
            success: function(e) {
                var a = "<strong>" + e.user + "</strong><div class='clearfix'></div><span>" + e.date + "</span><p>" + s.val() + "</p>\n";
                $(t).append(a), $(t).animate({
                    scrollTop: $(t)[0].scrollHeight
                }), $(s).val("")
            }
        })
    }), $(".cb-chat button").click(function() {
        var t = $(this).parent().children(".msgs"),
            s = $(this).parent().children(".msg"),
            i = $(this).parent().attr("data-lb"),
            n = $(this).parent().attr("data-res");
        $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/communication_with_restaurant/",
            type: "POST",
            data: {
                lb: i,
                res: n,
                msg: $(s).val()
            },
            success: function(e) {
                var a = "<strong>" + e.user + "</strong><div class='clearfix'></div><span>" + e.date + "</span><p>" + s.val() + "</p>\n";
                $(t).prepend(a), $(s).val("")
            }
        })
    }), $(".rm-btn").click(function(t) {
        t.preventDefault();
        var e = $(this).parents(".restaurants").find(".remove_restaurant");
        $(this).hasClass("clicked") ? (e.fadeOut(), $(this).removeClass("clicked")) : (e.fadeIn(), $(this).addClass("clicked"))
    }), $(".remove_restaurant").click(function(t) {
        t.preventDefault();
        var s = $(this).attr("data-res"),
            i = $(this).parent();
        $.ajax({
            beforeSend: function(t, s) {
                !e(s.type) && a(s.url) && t.setRequestHeader("X-CSRFToken", r)
            },
            url: "/control/remove_restaurant/",
            type: "POST",
            data: {
                res_id: s
            },
            success: function(t) {
                "success" == t.data.msg && $(i).remove()
            }
        })
    });
    var i = [];
    $(".remove_icon").click(function(t) {
        t.preventDefault(), t.stopPropagation();
        var e = $(this).data("image"),
            a = $(".images_del"),
            s = "<div class='deleted_image'><span class='glyphicon glyphicon-remove'></span></div>";
        $.inArray(e, i) < 0 ? (i.push(e), $(this).parent().append(s)) : (i = $.grep(i, function(t) {
            return t != e
        }), $(this).parent().find(".deleted_image").remove()), a.val(i)
    });
    var n = [];
    $(".remove_promo_code").click(function(t) {
        t.preventDefault(), t.stopPropagation();
        var e = $(this).data("code"),
            a = $(".pcodes_del");
        $.inArray(e, n) < 0 ? (n.push(e), $(this).parent().css("text-decoration", "line-through")) : (n = $.grep(i, function(t) {
            return t != e
        }), $(this).parent().css("text-decoration", "none")), a.val(n)
    });
    var o = window.location.pathname;
    $("a[href='" + o + "']").addClass("active"), o.match(/^\/control\/restaurant\/\d\/$/gm) ? $("#admin_restaurant_info").addClass("active") : o.match(/^\/control\/restaurant\/\d\/lunchbox\/create\/$/gm) ? $("#admin_create_lunchbox").addClass("active") : o.match(/^\/control\/restaurant\/\d\/published_lunchboxes\/$/gm) ? $("#admin_create_lunchbox").addClass("active") : o.match(/^\/control\/restaurant\/\d\/saved_lunchboxes\/$/gm) ? $("#admin_create_lunchbox").addClass("active") : o.match(/^\/control\/restaurant\/\d\/archived_lunchboxes\/$/gm) ? $("#admin_create_lunchbox").addClass("active") : o.match(/^\/control\/restaurant\/\d\/contract\/$/gm) && $("#admin_contract").addClass("active")
});