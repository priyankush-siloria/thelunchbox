
$(document).ready(function(){
    // var a=document.getElementById("useless_date");
    //var a=$("#useless_date").focus();

  
    
    $(".only_date").each(function(){
        $(this).focus();
        $(this).blur();
// console.log($(this));

    })


// console.log($(this));

    
    // alert(a);
});
  
 

function fixDiscount(e) {
    e && ($(".promo_code_input").val(""), code = ""), $(".promo_price").length && (total_price = parseFloat($(".total_price").text()), company_discount = 0, $(".promo_price").length && (company_discount = parseFloat($(".company_discount_price").text())), discount_price_num = total_price - company_discount, $(".discount_price").text(discount_price_num.toFixed(2))), $("#coupon_discount").remove()
}
var getUrlParameter = function(e) {
        var t, r, a = decodeURIComponent(window.location.search.substring(1)),
            n = a.split("&");
        for (r = 0; r < n.length; r++)
            if (t = n[r].split("="), t[0] === e) return void 0 === t[1] || t[1]
    },
    code = "";
window.addEventListener("resize", function(e) {
        (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || $(window).innerWidth() <= 800) && $("body").addClass("isMobile"), $(window).innerWidth() > 800 && $("body").removeClass("isMobile")
    }),
    function() {
        function e(e) {
            var t = null;
            if (document.cookie && "" != document.cookie)
                for (var r = document.cookie.split(";"), a = 0; a < r.length; a++) {
                    var n = jQuery.trim(r[a]);
                    if (n.substring(0, e.length + 1) == e + "=") {
                        t = decodeURIComponent(n.substring(e.length + 1));
                        break
                    }
                }
            return t
        }

        function t(e) {
            return /^(GET|HEAD|OPTIONS|TRACE)$/.test(e)
        }

        function r(e) {
            var t = document.location.host,
                r = document.location.protocol,
                a = "//" + t,
                n = r + a;
            return e == n || e.slice(0, n.length + 1) == n + "/" || e == a || e.slice(0, a.length + 1) == a + "/" || !/^(\/\/|http:|https:).*/.test(e)
        }

        function a() {
            var e = $("#id_password1").val(),
                t = $("#id_password2").val();
            if (e != t) {
                if ($("#id_password1").parent().addClass("has-error"), !$(".error_msg").length) {
                    var r = gettext("Passwords mismatch!");
                    $(".register_form").prepend('<label class="control-label small error_msg">' + r + "</label>")
                }
            } else $("#id_password1").parent().removeClass("has-error"), $(".error_msg").remove()
        }(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || $(window).innerWidth() <= 800) && $("body").addClass("isMobile");
        var n = e("csrftoken");
        $(".auth_email").length && $(".auth_email").click().focus(), $("#fullpage").fullpage({
            scrollOverflow: !0
        }), $(".small img").click(function() {
            $(this).parent().parent().children(".big").children("img").attr("src", $(this).data("image"))
        });
        var s;
        $(".restaurant-lunchbox").on({
            mouseenter: function(e) {
                var t = $(this).find(".hidden"),
                    r = 0;
                s = setInterval(function(a) {
                    r < t.length - 1 ? r++ : r = 0, void 0 !== $(t[r]).attr("src") && $(e.currentTarget).find(".big").css({
                        background: "silver",
                        "background-image": "url(" + $(t[r]).attr("src") + ")",
                        "background-size": "cover"
                    })
                }, 900)
            },
            mouseleave: function() {
                clearInterval(s)
            }
        }), $.fn.extend({
            animateCss: function(e) {
                var t = "webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";
                $(this).addClass("animated " + e).one(t, function() {
                    $(this).removeClass("animated " + e)
                })
            }
        }), 

        $(".add_to_basket").click(function(e) {
          
       
            var date_check = $(this).prevAll('input').val();

          if (date_check==''){
            $(this).prevAll('input').addClass('error');
            return false;
          }
            if ($(this).prevAll('.date_error_msg').length)  {
           $(this).prevAll('input').addClass('error');
                 
                return false;
                }
           


            e.preventDefault();
            var a = $(this).parent().parent().parent().data("lunchbox"),
                s = $(this).parent().find(".lb-qty").val();
                d=$(this).parent().find('.cart_delivery_date').val();
              var ti=$(this).parent().find('.time').val();
              cart.add(a,s)
               return false;
            $(this).hasClass("catering") ? $.ajax({
                beforeSend: function(e, a) {
                    !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                },
                url: "/add_to_catering_cart/",
                type: "POST",
                data: {
                    lunchbox: a,
                    qty: s,

                },
                success: function(e) {
                    humane.log(gettext("Lunchbox successfully added to catering!")), $(".cart-icon").animateCss("bounce")
                }
            }) : $.ajax({
                beforeSend: function(e, a) {
                    !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                },
                url: "/add_to_cart/",
                type: "POST",
                data: {
                    lunchbox: a,
                    qty: s,
                    date:d,
                    time:ti
                },
                success: function(e) {
                    humane.log(gettext("Lunchbox successfully added to basket!")), $(".cart-icon").animateCss("bounce"), $("#checkout_href").attr("href", "/cart/"), $("#checkout_nav_href").attr("href", "/cart/")
                }
            })
        }), $('.checkbox-radio input[type="checkbox"]').click(function() {
            $(this).parent().children("input").each(function() {
                $(this).prop("checked", !1)
            }), $(this).prop("checked", !0)
        }), $("#id_password2").keyup(a);
        var i = $("#id_company");
        i.length && i.change(function() {
            var e = $(this).val();
            alert("asdsadad");
            0 == parseInt(e) ? "/edit_user_profile/" == window.location.pathname ? $(".c_hidden").fadeIn() : window.location.href = "/company_registration/" : "/edit_user_profile/" == window.location.pathname && $(".c_hidden").fadeOut()
        }), $(".show_company_info").click(function(e) {
            e.preventDefault();
            var t = $("#id_company");
            $(t).children("option").each(function() {
                $(this).removeAttr("selected")
            }), $(t).find('option[value="0"]').prop("selected", !0), $(".c_hidden").fadeIn()
        }), $(".lb-chat").each(function() {
            $(this).children(".msgs").animate({
                scrollTop: $(this).children(".msgs")[0].scrollHeight
            }, 500)
        }), $(".lb-chat button").click(function() {
            var e = $(this).parent().children(".msgs"),
                a = $(this).parent().children(".msg"),
                s = $(this).parent().attr("data-lb"),
                i = $(this).parent().attr("data-res");
            $.ajax({
                beforeSend: function(e, a) {
                    !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                },
                url: "/ask_restaurant/",
                type: "POST",
                data: {
                    lb: s,
                    res: i,
                    msg: $(a).val()
                },
                success: function(t) {
                    var r = "<strong>" + t.user + "</strong><div class='clearfix'></div><span>" + t.date + "</span><p>" + a.val() + "</p>\n";
                    $(e).append(r), $(e).animate({
                        scrollTop: $(e)[0].scrollHeight
                    }), $(a).val("")
                }
            })
        }), $(".reviews button").click(function() {
            var e = $(this).parent().children(".review-msgs"),
                a = $(this).parent().children(".msg"),
                s = $(this),
                i = $(this).parent().attr("data-res"),
                o = $(".no_review_msg");
            $.ajax({
                beforeSend: function(e, a) {
                    !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                },
                url: "/leave_review/",
                type: "POST",
                data: {
                    res: i,
                    msg: $(a).val()
                },
                success: function(t) {
                    var r = "<strong>" + t.user + "</strong><div class='clearfix'></div><span>" + t.date + "</span><p>" + a.val() + "</p>\n";
                    o.length && o.remove(), $(e).append(r), $(e).animate({
                        scrollTop: $(e)[0].scrollHeight
                    }), $(a).val(""), $(a).remove(), $(s).remove(), $(".title").text("Reviews")
                }
            })
        }), $(".rate a").click(function(e) {
            e.preventDefault(), $(this).parents(".rate").children(".active").removeClass("active"), $(this).parent().addClass("active");
            var a = parseInt($(this).attr("data-rate")),
                s = ($(this).parents(".rate_this_lunchbox"), parseInt($(this).parents(".rate_this_lunchbox").attr("data-lb"))),
                i = $(this).parents(".restaurant").children(".restaurant-lunchboxes"),
                o = $(this).parents(".restaurant").find(".ribbon");
            $.ajax({
                beforeSend: function(e, a) {
                    !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                },
                url: "/rate_lunchbox/",
                type: "POST",
                data: {
                    lb: s,
                    rating: a
                },
                success: function(e) {
                    var t = e.data.lunchbox_rating,
                        r = parseInt(t),
                        a = "",
                        n = 0;
                    if (t = t.toFixed(1), o.length) {
                        for (o.children(".rating").text(t), n = 1; n <= r; n++) a += "<li><span class='glyphicon glyphicon-star'></span></li>";
                        for (n = 1; n <= 5 - r; n++) a += "<li><span class='glyphicon glyphicon-star-empty'></span></li>";
                        o.children(".stars").html(a)
                    } else {
                        var s = "";
                        for (a = '<ul class="stars">', n = 1; n <= r; n++) a += "<li><span class='glyphicon glyphicon-star'></span></li>";
                        for (n = 1; n <= 5 - r; n++) a += "<li><span class='glyphicon glyphicon-star-empty'></span></li>";
                        a += "</ul>", s += '<div class="ribbon"><p class="rating_txt">' + gettext("Rating") + '</p><p class="rating">' + t + "</p>" + a + "</div>", i.prepend(s)
                    }
                }
            })
        }), $(".request_lunchbox_again").click(function(e) {
            e.preventDefault();
            var a = parseInt($(this).attr("data-lb")),
                s = $(this).parent().children(".qty");
            $.ajax({
                beforeSend: function(e, a) {
                    !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                },
                url: "/request_lunchbox/",
                type: "POST",
                data: {
                    lb: a
                },
                success: function(e) {
                    if ("success" === e.msg) {
                        var t = e.data.requests;
                        s.text(t)
                    }
                }
            })
        }), $(".edit_and_save").click(function(e) {
            e.preventDefault(), $("#id_c_last_name, #id_c_first_name, #id_c_address, #id_c_zipcode, #id_c_phone").removeClass("unselectable").attr("readonly", !1), $(this).hasClass("clicked") ? $(".register_form").submit() : ($(this).addClass("clicked"), $(this).val("Save"))
        }), ($(".timepicker").length || $(".datepicker").length || $(".datetimepicker").length) && ($(".timepicker").datetimepicker({
            datepicker: !1,
            format: "H:i",
            theme: "dark",
            minDate: 0
        }), $(".datepicker").datetimepicker({
            timepicker: !1,
            format: "M d Y",
            theme: "dark",
            minDate: 0
        }), $(".datetimepicker").datetimepicker({
            format: "M d Y H:i",
            theme: "dark",
            minDate: 0
        })), $(".delivery").length && $(".qty").change(function() {
            var e = $(this).parent(),
                t = $(this).attr("data-item-id"),
                r = $(this).val(),
                a = "<form action='/update_item_qty/' method='GET'><input name='new_qty' type='hidden' value=" + r + "><input name='order_item_id' type='hidden' value=" + t + "><input type='submit' class='update-btn btn btn-default' value='" + gettext("Update basket") + "'></form>";
            e.next("form").length <= 0 ? e.after(a) : (e.next("form").remove(), e.after(a))
        });
        var o = null;
        $(".promo_code_input").on("keyup", function() {
            var e = this;
            null !== o && clearTimeout(o), o = setTimeout(function() {
                if ($(e).val().length >= 3 && code != $(e).val()) {
                    code = $(e).val();
                    var a = $(".total"),
                        s = parseFloat($(".total_price").text()),
                        i = $(".discount_price"),
                        o = parseFloat(i.text()),
                        c = 0;
                    $.ajax({
                        beforeSend: function(e, a) {
                            !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                        },
                        url: "/get_promo_code_discount/",
                        type: "POST",
                        data: {
                            code: code
                        },
                        success: function(t) {
                            if (fixDiscount(!1), "success" == t.status) {
                                var r = parseFloat(t.discount),
                                    n = 0;
                                if (i = $(".discount_price"), i.length) o = parseFloat(i.text()), n = o * r / 100, c = o - n, prepend_html = "<div id='coupon_discount'> <span id='close' onclick='fixDiscount(true)'>x</span><strong class='total_with_discount_txt'>" + gettext("Coupon discount") + ": " + code + "<span class='pull-right'><span class='promo_price'> -" + n.toFixed(2) + "</span> eur</span></div>", $("#total_discount").prepend(prepend_html), i.text(c.toFixed(2));
                                else {
                                    n = s * r / 100, c = s - n;
                                    var l = "<div id='coupon_discount'> <span id='close' onclick='fixDiscount(true)'>x</span><strong class='total_with_discount_txt'>" + gettext("Coupon discount") + ": " + code + "<span class='pull-right'><span class='promo_price'>-" + n.toFixed(2) + "</span> eur</span><div id='total_discount'><strong class='total_with_discount_txt'>" + gettext("With discount") + "<span class='pull-right'><span class='discount_price'>" + c.toFixed(2) + "</span> eur</span></strong></div>";
                                    $(".catering_delivery_date").length ? $("#total_amount_txt").append(l) : a.append(l)
                                }
                                window.promo_discount = r, $("p#couponErr").html(""), $(e).removeClass("error")
                            } else {
                                var d = t.msg;
                                $("p#couponErr").html(d), $(e).addClass("error")
                            }
                        }
                    })
                }
            }, 1e3)
        }), $(".cart_checkout_btn").click(function() {
            var e = $(this).prev(),
                t = $(".checkout_orders"),
                r = $(".date_error"),
                a = !0,
                n = new Date,
                s = !1,
                i = {
                    promo_code: $(".promo_code_input").val(),
                    orders: [],
                    restaurants: []
                };
            (12 === n.getHours() && n.getMinutes() >= 1 || n.getHours() > 12) && n.setDate(n.getDate() + 1), n.setHours(0, 0, 0, 0), $(".restaurant-lunchboxes").each(function() {
                function e(e) {
                    e.restaurant === c && (e.qty += r)
                }
                var t = parseInt($(this).attr("data-lunchbox")),
                    r = parseInt($(this).find(".lb-qty").val()),
                    o = $(this).find(".cart_delivery_date"),
                    c = $(this).attr("restaurant-name"),
                    l = $(this).attr("restaurant-min-order");
                o.val() ? new Date(o.val()).getTime() < n.getTime() ? s = !0 : o.removeClass("error") : (o.addClass("error"), a = !1), i.orders.push({
                    lb: t,
                    qty: r,
                    date: o.val()
                }), i.restaurants.some(function(e) {
                    return e.restaurant === c
                }) ? i.restaurants.map(e) : i.restaurants.push({
                    restaurant: c,
                    minOrder: l,
                    qty: r
                })
            }), r.remove();
            var o = !1;
            $(".date_error_msg").length > 0 && ($(".total").prepend("<p class='error_msg date_error'>" + gettext("There are restaurants closed on the selected delivery dates") + ".</p>"), o = !0), a || $(".total").prepend("<a href='#footer' class='error_msg date_error'>" + gettext("Missing delivery dates of lunchboxes!") + "</a>");
            var c = !0;
            i.restaurants.every(function(e) {
                return e.qty >= e.minOrder
            }) || ($(".total").prepend("<p class='error_msg date_error'>" + gettext("Check minimum order of lunchboxes!") + "</p>"), c = !1), s && $(".total").prepend("<p class='error_msg date_error'>" + gettext("Invalid delivery date! Your order can be delivered from tomorrow") + ".</p>"), a && c && !s && !o ? ($(t).val(JSON.stringify(i)), e.submit()) : document.getElementById("paymentModal").style.display = "none"
        }),

         $(".cart_delivery_date").change(function() {
        
            var e = "";
            void 0 !== $(this).attr("data-lunchbox-id") && (e = $(this).attr("data-lunchbox-id"));
            var a = $(this).val(),
                s = $(this);

                "" !== a && $.ajax({
                beforeSend: function(e, a) {
                    !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                },
                url: "/check_restaurant_availability/",
                type: "POST",
                data: {
                    lunchbox_id: e,
                    delivery_date: a
                },
                success: function(t) {

                    if (s.next().hasClass("date_error_msg") && s.next().remove(), "error" === t.status) {
                        var r = "";
                        "" === e ? (r = "<p class='date_error_msg' style='line-height: 2;'>" + gettext("The following restaurants are closed on the selected date") + ": ", r += t.closed_restaurants.join(", ") + "</p>") : r = "<p class='date_error_msg' style='margin-bottom: -10px;'>" + gettext("The restaurant is closed on the selected date ") + "</p>", s.after(r)
                    }
                }
            })
        }), $(".catering_cart_checkout_btn").click(function() {
            var e = $(this).prev(),
                t = $(".checkout_orders"),
                r = $(".delivery_info"),
                a = $(".date_error"),
                n = $(".datetimepicker").val(),
                s = new Date,
                i = {
                    promo_code: $(".promo_code_input").val(),
                    orders: [],
                    restaurants: []
                },
                o = $("#catering_delivery_info :input"),
                c = {};
            o.each(function() {
                c[this.name] = $(this).val()
            }), (12 === s.getHours() && s.getMinutes() >= 1 || s.getHours() > 12) && s.setDate(s.getDate() + 1), s.setHours(0, 0, 0, 0), $(".restaurant-lunchboxes").each(function() {
                function e(e) {
                    e.restaurant === a && (e.qty += r)
                }
                var t = parseInt($(this).attr("data-lunchbox")),
                    r = parseInt($(this).find(".lb-qty").val()),
                    a = $(this).attr("restaurant-name"),
                    s = $(this).attr("restaurant-min-order");
                i.orders.push({
                    lb: t,
                    qty: r,
                    restaurant: a,
                    date: n
                }), i.restaurants.some(function(e) {
                    return e.restaurant === a
                }) ? i.restaurants.map(e) : i.restaurants.push({
                    restaurant: a,
                    minOrder: s,
                    qty: r
                })
            }), a.remove();
            var l = !1;
            if ($(".date_error_msg").length > 0) {
                var d = gettext("There are restaurants closed on the selected delivery date");
                $(".total").prepend("<p class='error_msg date_error'>" + d + ".</p>"), l = !0
            }
            var u = !0;
            if (n) {
                var p = new Date(n);
                p.getTime() < s.getTime() && ($(".total").prepend("<p class='error_msg date_error'>" + gettext("Invalid delivery date. Your order can be delivered from tomorrow") + ".</p>"), u = !1), (p.getHours() < 13 || 16 === p.getHours() && p.getMinutes() > 0 || p.getHours() > 16) && ($(".total").prepend("<p class='error_msg date_error'>" + gettext("Invalid delivery time. Orders can be delivered between 1pm - 4pm") + ".</p>"), u = !1)
            } else $(".total").prepend("<p class='error_msg date_error'>" + gettext("Missing delivery date and time of order!") + "</p>"), u = !1;
            var h = !0;
            i.restaurants.every(function(e) {
                return e.qty >= e.minOrder
            }) || ($(".total").prepend("<p class='error_msg date_error'>" + gettext("Check minimum order of lunchboxes!") + "</p>"), h = !1), u && h && !l ? ($(t).val(JSON.stringify(i)), $(r).val(JSON.stringify(c)), e.submit()) : document.getElementById("paymentModal").style.display = "none"
        }), $(".service-rating").click(function() {
            var e = $(this).attr("data-rating"),
                a = getUrlParameter("order-uuid"),
                s = $(this).parent().parent().parent().children(".note");
            $.ajax({
                beforeSend: function(e, a) {
                    !t(a.type) && r(a.url) && e.setRequestHeader("X-CSRFToken", n)
                },
                url: "/service_rating/",
                type: "POST",
                data: {
                    order_uuid: a,
                    rating: e
                },
                success: function(e) {
                    if ("success" == e.status) {
                        var t = "<p class='text-center rating-sent'>" + gettext("Rating sent!") + "</p>";
                        $(s).prepend(t), window.location.replace(window.location.protocol + "//" + window.location.host)
                    }
                }
            })
        }), $(".paypal_form").length && $(window).load(function() {
            $(".paypal_form form").submit()
        })
    }();